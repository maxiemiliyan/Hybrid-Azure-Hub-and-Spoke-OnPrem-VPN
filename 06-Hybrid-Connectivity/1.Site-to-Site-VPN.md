# Site-to-Site VPN Connectivity

## Overview

This document describes the implementation of **Site-to-Site VPN connectivity** between the **on-premises environment** and **Microsoft Azure** as part of the hybrid Hub-and-Spoke architecture.

The VPN connection provides a **secure, encrypted communication channel** between the on-premises Windows Server 2019 environment and the Azure Hub Virtual Network, enabling controlled access to on-prem resources from Azure workloads.

---

## Purpose of Site-to-Site VPN

The Site-to-Site VPN is implemented to:

- Enable secure hybrid connectivity
- Protect data in transit using encryption
- Allow Azure workloads to access on-prem resources
- Maintain centralized routing and security enforcement
- Avoid exposing on-prem resources directly to the internet

---

## VPN Architecture

The VPN tunnel is established between:

- **On-Premises Endpoint**
  - Windows Server 2019
  - Routing and Remote Access Service (RRAS)

- **Azure Endpoint**
  - Azure VPN Gateway
  - Deployed in the Hub Virtual Network

All VPN traffic passes through the Azure Hub VNet.

---

## VPN Configuration Details

### VPN Type

- VPN Type: Route-based
- Tunnel Protocol: IPsec
- Key Exchange: IKEv2
- Authentication: Pre-shared key

Route-based VPN is used to support dynamic routing and scalable hybrid connectivity.

---

### Azure-Side Configuration

- Azure VPN Gateway deployed in the Hub VNet
- Gateway Subnet created for VPN services
- Local Network Gateway configured with:
  - On-prem public IP address
  - On-prem address space (`10.0.0.0/24`)
- Site-to-Site VPN connection created between:
  - Azure VPN Gateway
  - Local Network Gateway

---

### On-Premises Configuration

- RRAS installed and configured on Windows Server 2019
- Demand-dial interface created for Azure VPN Gateway
- Static routes configured for Azure address spaces
- IP forwarding enabled
- NAT disabled to support route-based VPN connectivity

---

## Traffic Flow Through VPN

### Azure to On-Prem

Azure Workload → Hub VNet → Azure Firewall → VPN Gateway → IPsec Tunnel → RRAS → On-Prem Resource

---

### On-Prem to Azure

On-Prem Resource → RRAS → IPsec Tunnel → VPN Gateway → Azure Firewall → Azure Workload


---

## Security Considerations

- All traffic is encrypted using IPsec
- Pre-shared keys are used for authentication
- VPN traffic is inspected by Azure Firewall after entering the Hub
- No direct internet exposure for on-prem resources

---

## Validation and Monitoring

The VPN connectivity is validated by:

- Verifying VPN connection status as **Connected**
- Monitoring ingress and egress traffic on Azure VPN Gateway
- Testing bi-directional connectivity between:
  - Azure workloads and on-prem resources
- Confirming traffic inspection via Azure Firewall metrics

---

## Outcome

The Site-to-Site VPN provides a **secure and reliable hybrid connection** that enables seamless communication between Azure and on-premises environments while preserving centralized routing and security enforcement.
